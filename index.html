<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"><title>Connect 4</title>
<style>
  body {margin:0;background:#000;display:flex;flex-direction:column;align-items:center;color:white}
  canvas {margin-top:10px}
  button {margin-top:10px;padding:10px 20px;background:#444;color:white;border:none;border-radius:5px;cursor:pointer}
  button:hover {background:#666}
  .message {font-size:24px;margin-top:10px;color:#F00;}
</style>
</head>
<body>
<label>AI Depth: <input type="range" id="depth" min="1" max="6" value="4"></label>
<canvas id="c" width="700" height="600"></canvas>
<button id="restartBtn">Restart Game</button>
<div class="message" id="gameMessage"></div>
<script>
const ROWS=6,COLS=7,SIZE=100,R=SIZE/2-5;
const P1=1,P2=2,E=0,W=4;
let board=[...Array(ROWS)].map(()=>Array(COLS).fill(E));
let turn=P1,gameOver=0;
const c=document.getElementById("c"),ctx=c.getContext("2d");
const gameMessage = document.getElementById("gameMessage");
const restartBtn = document.getElementById("restartBtn");

function draw(){
  ctx.clearRect(0,0,c.width,c.height);
  for(let r=0;r<ROWS;r++)for(let col=0;col<COLS;col++){
    ctx.fillStyle="#00F";ctx.fillRect(col*SIZE,r*SIZE,SIZE,SIZE);
    ctx.beginPath();
    ctx.arc(col*SIZE+SIZE/2,r*SIZE+SIZE/2,R,0,2*Math.PI);
    ctx.fillStyle=board[r][col]==P1?"#F00":board[r][col]==P2?"#FF0":"#000";
    ctx.fill();
  }
}

function copyBoard(b){ return JSON.parse(JSON.stringify(b)); }

function validLoc(b,col){ return b[0][col]==E; }

function nextRow(b,col){
  for(let r=ROWS-1;r>=0;r--)if(b[r][col]==E)return r;
  return null;
}

function win(b,p){
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS-3;c++)
    if([0,1,2,3].every(i=>b[r][c+i]==p))return true;
  for(let c=0;c<COLS;c++)for(let r=0;r<ROWS-3;r++)
    if([0,1,2,3].every(i=>b[r+i][c]==p))return true;
  for(let r=0;r<ROWS-3;r++)for(let c=0;c<COLS-3;c++)
    if([0,1,2,3].every(i=>b[r+i][c+i]==p))return true;
  for(let r=3;r<ROWS;r++)for(let c=0;c<COLS-3;c++)
    if([0,1,2,3].every(i=>b[r-i][c+i]==p))return true;
  return false;
}

function evalWin(w,p){
  let s=0,o=p==P1?P2:P1;
  let c=w.filter(x=>x==p).length;
  let e=w.filter(x=>x==E).length;
  if(c==4)s+=100;
  else if(c==3&&e==1)s+=5;
  else if(c==2&&e==2)s+=2;
  if(w.filter(x=>x==o).length==3&&e==1)s-=4;
  return s;
}

function scorePos(b,p){
  let s=0;
  let center=b.map(r=>r[Math.floor(COLS/2)]);
  s+=center.filter(x=>x==p).length*3;
  for(let r=0;r<ROWS;r++)for(let c=0;c<COLS-3;c++)
    s+=evalWin(b[r].slice(c,c+W),p);
  for(let c=0;c<COLS;c++)for(let r=0;r<ROWS-3;r++)
    s+=evalWin([0,1,2,3].map(i=>b[r+i][c]),p);
  for(let r=0;r<ROWS-3;r++)for(let c=0;c<COLS-3;c++)
    s+=evalWin([0,1,2,3].map(i=>b[r+i][c+i]),p);
  for(let r=3;r<ROWS;r++)for(let c=0;c<COLS-3;c++)
    s+=evalWin([0,1,2,3].map(i=>b[r-i][c+i]),p);
  return s;
}

function validCols(b){ return [...Array(COLS).keys()].filter(c=>validLoc(b,c)); }

function term(b){ return win(b,P1)||win(b,P2)||validCols(b).length==0; }

function minimax(b,d,a,beta,maxim){
  let valCols=validCols(b);
  let t=term(b);
  if(d==0||t){
    if(t){
      if(win(b,P2))return [null,1e9];
      else if(win(b,P1))return [null,-1e9];
      else return [null,0];
    }
    return [null,scorePos(b,P2)];
  }
  if(maxim){
    let v=-1e9,col=valCols[Math.floor(Math.random()*valCols.length)];
    for(let c of valCols){
      let r=nextRow(b,c),b2=copyBoard(b);
      b2[r][c]=P2;
      let s=minimax(b2,d-1,a,beta,false)[1];
      if(s>v){v=s;col=c;}
      a=Math.max(a,v);
      if(a>=beta)break;
    }
    return [col,v];
  }else{
    let v=1e9,col=valCols[Math.floor(Math.random()*valCols.length)];
    for(let c of valCols){
      let r=nextRow(b,c),b2=copyBoard(b);
      b2[r][c]=P1;
      let s=minimax(b2,d-1,a,beta,true)[1];
      if(s<v){v=s;col=c;}
      beta=Math.min(beta,v);
      if(a>=beta)break;
    }
    return [col,v];
  }
}

c.onclick=e=>{
  if(gameOver)return;
  let x=Math.floor(e.offsetX/SIZE);
  if(validLoc(board,x)){
    let r=nextRow(board,x);
    board[r][x]=P1;
    if(win(board,P1)){
      gameMessage.textContent = "You win!";
      gameOver=1;
    }
    else{
      let depth=+document.getElementById("depth").value;
      let [aiCol]=minimax(board,depth,-1e9,1e9,true);
      if(validLoc(board,aiCol)){
        let r2=nextRow(board,aiCol);
        board[r2][aiCol]=P2;
        if(win(board,P2)){
          gameMessage.textContent = "AI wins!";
          gameOver=1;
        }
      }
    }
    if(validCols(board).length==0&&!gameOver){
      gameMessage.textContent = "Draw!";
      gameOver=1;
    }
    draw();
  }
};

restartBtn.onclick = () => {
  board = [...Array(ROWS)].map(() => Array(COLS).fill(E));
  gameOver = 0;
  gameMessage.textContent = "";
  draw();
};

draw();
</script>
</body>
</html>
